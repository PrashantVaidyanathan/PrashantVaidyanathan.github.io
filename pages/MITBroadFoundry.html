<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>MIT - Broad Foundry</title>
<script type="text/javascript" src="../JS/clotho3API.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.0/q.js"></script>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script >
function onSubmitBtnClick()
{
	var text = document.getElementById("gateupload").value;
	window.alert(text);
}
function onUploadFileClick()
{
	if(!(window.File && window.FileReader && window.FileList && window.Blob))
	{
		alert('File APIs are not fully supported in this browser. This may cause issues.');
	}
}
window.onload = function()
{
	var fileinput = document.getElementById('gateuploadbtn');
	var gatetextarea = document.getElementById('gateupload');
	fileinput.addEventListener('change',
	function(e) 
	{
		var file = fileinput.files[0];
		var textType = /text.*/;
		if(file.type.match(textType))
		{
			var fileReader = new FileReader();
			fileReader.onload = function(e) 
			{
				gatetextarea.innerText = fileReader.result;
			}
			fileReader.readAsText(file);
		}
		else
		{
			alert("Please Upload a Valid Text file");
		}
	});
}

function readSampleGatesFile()
{
	var gatetextarea = document.getElementById('gateupload');
	var txtFile = new XMLHttpRequest();
	txtFile.open("GET", "http://prashantvaidyanathan.github.io/resources/SampleBroad.txt", true);
	txtFile.onreadystatechange = function() 
	{
		if (txtFile.readyState === 4) 
		{ 
			if (txtFile.status === 200) 
			{ 
				allText = txtFile.responseText; 
				gatetextarea.innerText = allText;
			}
		}
	}
	txtFile.send(null);
}

</script>

</head>


<body>


<div align="center">
<h1 style="font-family:Arial, Helvetica, sans-serif;">Upload Cello Gates</h1> 

<textarea id="gateupload" rows="30" cols="60"> </textarea>
</div>
<div align="center">
<input type="file"  id="gateuploadbtn">
<input type="button" value="Upload Sample File" onclick="readSampleGatesFile()">
<input type="submit" id="submitbtn" onclick="onSubmitBtnClick()" />
</div>
	
<div align="center">

<!--
<button id="query" type="button" class="btn btn-success btn-lg">Query</button>
<button id="destroy" type="button" class="btn btn-success btn-lg">Destroy</button>
<button id="set" type="button" class="btn btn-success btn-lg">Set</button>
<button id="createAll" type="button" class="btn btn-success btn-lg">Create All</button>
<button id="queryOne" type="button" class="btn btn-success btn-lg">Query One</button>
-->
<!-- <button id="connect" type="button" class="btn btn-primary btn-lg">Connect</button> -->
<form>
<input type="radio" value="AsJSON" name="inputType" id="asJson" checked>As Jason
<input type="radio" value="Parse" name="inputType" id="parse" >Parse<br>
</form>
<button id="create" type="button" class="btn btn-success btn-lg">Save</button><br>


<!-- <input id="bgname" type = "text"> Gate Name </input>
<button id="get" type="button" class="btn btn-success btn-lg">Get</button><br>
<input id="pmax" type = "text"> pMin </input>
<input id="pmin" type = "text"> pMax </input><br>
<input id="kd" type = "text"> kd </input>
<input id="gaten" type = "text"> n </input> --> 



<script>
            $(document).ready(function() {
			//alert("Clicked on The connect button"); 
                $("#connect").click(function() {
                    alert("Connecting");
                });
                $("#get").click(function() {
		    alert("Button clicked!");
		    var querydata = document.getElementById('bgname').value;
			alert(querydata);
                    Clotho.get(querydata).then(function(data) {
			alert(data);			
			alert(data.pMax);
			alert(data.pMin);
			alert(data.kd);
			alert(data.n);
		    document.getElementById('pmax').value = data.pMax; 
                    document.getElementById('pmin').value = data.pMin; 
                    document.getElementById('kd').value = data.kd; 
                    document.getElementById('gaten').value = data.n; 
                    }).done();
                });
                $("#query").click(function() {
                    Clotho.query("schema", "CompositePart").then(function(data) {
                        alert(data.length);
                    }).done();
                });
                $("#queryOne").click(function() {
                    Clotho.queryOne("schema", "CompositePart").then(function(data) {
                        alert(data.name);
                    }).done();
                });
                $("#create").click(function() {

		    var gatelines = document.getElementById('gateupload').value;
		    var gatearray = gatelines.split("\n");

		if(document.getElementById('asJson').checked)
		{
			for(var i=0;i< gatearray.length;i++)
	            	{
				gateparts = gatearray[i];
				obj = JSON.parse(gateparts);
				Clotho.create(obj);	
	            	}
		}		
		else if(document.getElementById('parse').checked)
		{
			for(var i=0;i< gatearray.length;i++)
	            	{
				var gateparts = gatearray[i].split(" ");
				var gtstring = "";				
				gtstring += "{"				
				for(var j=0; j<gateparts.length-1;j++)
				{
					var gatecomp = gateparts[j].split(":");
					gtstring += ("\""+gatecomp[0]+"\":\""+gatecomp[1]+"\",");
				}
				var gatecomp = gateparts[gateparts.length-1].split(":");
				gtstring += ("\""+gatecomp[0]+"\":\""+gatecomp[1]+"\"");
				gtstring += "}"				
				obj = JSON.parse(gtstring);
				Clotho.create(obj);
			}
		}
		    /*stringobj = "{\"name\":\"stringate\",\"randomprop\":\"3.142567\"}";
		    obj = JSON.parse(stringobj);
		    Clotho.create(obj);
		    obj = [{"name":"trygate2", "prop1":"3.456", "subprop": {"attr1":"42", "reason":"Answer to life"}, "prop2":"Success"}];
		    Clotho.create(obj);*/
		    
	            var textmessage = gatearray.length + " Gates added.";
	            alert(textmessage);
                    //obj = {"name":"NOT_rbs1-PhlF", "pMax":"17.22043" , "pMin":"0.073805" , "kd":"0.560868" , "n":"3.876935" };
                    //Clotho.create(obj);
                    //Clotho.get("NOT_rbs1-PhlF").then(function(data) {
                    //    alert(data.n);
                    //}).done();
                    // Clotho.create(obj).then(function(id) {
                    //     Clotho.get(id).then(function(data) {
                    //         alert(data.sequence);
                    //     }).done();
                    // });
                });
                $("#createAll").click(function() {
                    Clotho.create([{"name":"My New Part", "sequence":"GGGGGG"},{"name":"My Second Part", "sequence":"AAACCC"}]).then(function(id) {
                        alert(JSON.stringify(id));        
                    }).done();
                });
                $("#destroy").click(function() {
                    Clotho.destroy("My New Part");
                });
                $("#set").click(function() {
                    Clotho.get("Test Part 1").then(function(data) {
                        alert(data.name);
                        storeID = data.id;
                        Clotho.set({"id":storeID, "name":"Kev's Trial Part"}).then(function(data2) {
                            Clotho.get(storeID).then(function(data3) {
                                alert(data3.name);
                                Clotho.set({"id":storeID, "name":"Test Part 1"}).then(function(data4) {
                                    Clotho.get(storeID).then(function(data5) {
                                        alert(data5.name);
                                    }).done()
                                });
                            });
                        });
                    });
                });
            });
        </script>    
</div>




</body>
</html>
