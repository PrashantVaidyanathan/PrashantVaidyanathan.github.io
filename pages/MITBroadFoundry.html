<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>MIT - Broad Foundry</title>
        <script type="text/javascript" src="../JS/clotho3API.js"></script>
		  <link rel="stylesheet" type="text/css" href="../css/style.css">
        <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.0/q.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        
   
    	 <script type="text/javascript">
    	 jQuery(document).ready(function() {
    			jQuery('.tabs .tab-links a').on('click', function(e)  {
        		var currentAttrValue = jQuery(this).attr('href');
 
        		// Show/Hide Tabs
        		jQuery('.tabs ' + currentAttrValue).show().siblings().hide();
 
        		// Change/remove current tab to active
        		jQuery(this).parent('li').addClass('active').siblings().removeClass('active');
 
        		e.preventDefault();
    		});
		});
    	</script>
  
        
        <script >
            function onSubmitBtnClick()
            {
                var text = document.getElementById("gateupload").value;
                window.alert(text);
            }
            function onUploadFileClick()
            {
                if (!(window.File && window.FileReader && window.FileList && window.Blob))
                {
                    alert('File APIs are not fully supported in this browser. This may cause issues.');
                }
            }
            window.onload = function()
            {
                var fileinput = document.getElementById('gateuploadbtn');
                var gatetextarea = document.getElementById('gateupload');
                fileinput.addEventListener('change',
                        function(e)
                        {
                            var file = fileinput.files[0];
                            var textType = /text.*/;
                            if (file.type.match(textType))
                            {
                                var fileReader = new FileReader();
                                fileReader.onload = function(e)
                                {
                                    gatetextarea.innerText = fileReader.result;
                                }
                                fileReader.readAsText(file);
                            }
                            else
                            {
                                alert("Please Upload a Valid Text file");
                            }
                        });
            }

            function readSampleGatesFile()
            {
                var gatetextarea = document.getElementById('gateupload');
                var txtFile = new XMLHttpRequest();
                txtFile.open("GET", "http://prashantvaidyanathan.github.io/resources/SampleBroad.txt", true);
                txtFile.onreadystatechange = function()
                {
                    if (txtFile.readyState === 4)
                    {
                        if (txtFile.status === 200)
                        {
                            allText = txtFile.responseText;
                            gatetextarea.innerText = allText;
                        }
                    }
                }
                txtFile.send(null);
            }

        </script>
		  <script>
                $(document).ready(function() {
                    //alert("Clicked on The connect button"); 
                    $("#connect").click(function() {
                        alert("Connecting");
                    });
                    $("#get").click(function() {
                        alert("Button clicked!");
                        var querydata = document.getElementById('bgname').value;
                        alert(querydata);
                        Clotho.get(querydata).then(function(data) {
                            alert(data);
                            alert(data.pMax);
                            alert(data.pMin);
                            alert(data.kd);
                            alert(data.n);
                            document.getElementById('pmax').value = data.pMax;
                            document.getElementById('pmin').value = data.pMin;
                            document.getElementById('kd').value = data.kd;
                            document.getElementById('gaten').value = data.n;
                        }).done();
                    });
                    $("#query").click(function() {
                        Clotho.query("schema", "CompositePart").then(function(data) {
                            alert(data.length);
                        }).done();
                    });
                    $("#queryOne").click(function() {
                        Clotho.queryOne("schema", "CompositePart").then(function(data) {
                            alert(data.name);
                        }).done();
                    });
                    $("#create").click(function() {

                        var gatelines = document.getElementById('gateupload').value;
                        var gatearray = gatelines.split("\n");

                        if (document.getElementById('asJson').checked)
                        {
                            for (var i = 0; i < gatearray.length; i++)
                            {
                                gateparts = gatearray[i];
                                obj = JSON.parse(gateparts);
                                Clotho.create(obj);
                            }
                        }
                        else if (document.getElementById('parse').checked)
                        {
                            for (var i = 0; i < gatearray.length; i++)
                            {
                                var gateparts = gatearray[i].split(" ");
                                var gtstring = "";
                                gtstring += "{"
                                for (var j = 0; j < gateparts.length - 1; j++)
                                {
                                    var gatecomp = gateparts[j].split(":");
                                    gtstring += ("\"" + gatecomp[0] + "\":\"" + gatecomp[1] + "\",");
                                }
                                var gatecomp = gateparts[gateparts.length - 1].split(":");
                                gtstring += ("\"" + gatecomp[0] + "\":\"" + gatecomp[1] + "\"");
                                gtstring += "}"
                                obj = JSON.parse(gtstring);
                                Clotho.create(obj);
                            }
                        }
                        /*stringobj = "{\"name\":\"stringate\",\"randomprop\":\"3.142567\"}";
                         obj = JSON.parse(stringobj);
                         Clotho.create(obj);
                         obj = [{"name":"trygate2", "prop1":"3.456", "subprop": {"attr1":"42", "reason":"Answer to life"}, "prop2":"Success"}];
                         Clotho.create(obj);*/

                        var textmessage = gatearray.length + " Gates added.";
                        alert(textmessage);
                        //obj = {"name":"NOT_rbs1-PhlF", "pMax":"17.22043" , "pMin":"0.073805" , "kd":"0.560868" , "n":"3.876935" };
                        //Clotho.create(obj);
                        //Clotho.get("NOT_rbs1-PhlF").then(function(data) {
                        //    alert(data.n);
                        //}).done();
                        // Clotho.create(obj).then(function(id) {
                        //     Clotho.get(id).then(function(data) {
                        //         alert(data.sequence);
                        //     }).done();
                        // });
                    });
                    $("#createAll").click(function() {
                        Clotho.create([{"name": "My New Part", "sequence": "GGGGGG"}, {"name": "My Second Part", "sequence": "AAACCC"}]).then(function(id) {
                            alert(JSON.stringify(id));
                        }).done();
                    });
                    $("#destroy").click(function() {
                        Clotho.destroy("My New Part");
                    });
                    $("#set").click(function() {
                        Clotho.get("Test Part 1").then(function(data) {
                            alert(data.name);
                            storeID = data.id;
                            Clotho.set({"id": storeID, "name": "Kev's Trial Part"}).then(function(data2) {
                                Clotho.get(storeID).then(function(data3) {
                                    alert(data3.name);
                                    Clotho.set({"id": storeID, "name": "Test Part 1"}).then(function(data4) {
                                        Clotho.get(storeID).then(function(data5) {
                                            alert(data5.name);
                                        }).done()
                                    });
                                });
                            });
                        });
                    });
                });
            </script>    
    </head>


    <body>
    
   
    
	<div class="menuDiv" >
		<div style="white-space: nowrap;" align="center" >
			<h1 class="nameHeader">Clotho - MIT-BroadFoundry Demo</h1> 			
       </div>	   
	</div>
    
   <div class="mainBodyDiv" >
   	<div class="mainConsole" >
   	
   	
   	<div class="tabs">
    <ul class="tab-links">
        <li class="active"><a href="#tab1">Upload Parts</a></li>
        <li><a href="#tab2">Query Parts</a></li>
        <li><a href="#tab3">Run Functions</a></li>
        
    </ul>
 
    <div class="tab-content">
        <div id="tab1" class="tab active">
           	<div align="center">
  	 	 		<textarea id="gateupload" rows="15" cols="60"> </textarea>
  	 	 		<br>
				<input type="file"  id="gateuploadbtn">
				<input type="button" value="Upload Sample File" onclick="readSampleGatesFile()">
				<input type="submit" id="submitbtn" onclick="onSubmitBtnClick()" />
  			</div>
  		<div align="center">
			<form>
 				<input type="radio" value="AsJSON" name="inputType" id="asJson" checked>As Jason
 				<input type="radio" value="Parse" name="inputType" id="parse" >Parse<br>
			</form>
			<button id="create" type="button" class="btn btn-success btn-lg">Save</button><br>
  	 	</div>
        </div>
 
        <div id="tab2" class="tab">
            <p>Tab #2 content goes here!</p>
        </div>
 
        <div id="tab3" class="tab">
            <p>Tab #3 content goes here!</p>
        </div>
        
    </div>
</div>
  	   
  	 	</div>
  	 
  	 	<div class="debugConsole" >
  	 	<div align="center">
  	 	 	<p style="font-size:20px;"> <b>Debug Console</b></p> 
 			<textarea id="debugWindow" style="width:50%; min-height:200px; height:100%; background-color:#9CFFA4;float:left" ></textarea> 	 	
			<textarea id="outputWindow" style="width:49%; min-height:200px; height:100%; background-color:#E31010;float:left" ></textarea> 	 	
			
  	 	</div>
  	   </div>
  	</div>
	
	
 	</body>
</html>
