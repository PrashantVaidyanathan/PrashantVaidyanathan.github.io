<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>MIT - Broad Foundry</title>
    <script type="text/javascript" src="../JS/clotho3API.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.0/q.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>


    <script type="text/javascript">
    jQuery(document).ready(function() {
        jQuery('.tabs .tab-links a').on('click', function(e)  {
            var currentAttrValue = jQuery(this).attr('href');

// Show/Hide Tabs
jQuery('.tabs ' + currentAttrValue).show().siblings().hide();

// Change/remove current tab to active
jQuery(this).parent('li').addClass('active').siblings().removeClass('active');

e.preventDefault();
});
    });
    </script>


    <script >
    function onSubmitBtnClick()
    {
        var text = document.getElementById("gateupload").value;
        window.alert(text);
    }
    function onUploadFileClick()
    {
        if (!(window.File && window.FileReader && window.FileList && window.Blob))
        {
            alert('File APIs are not fully supported in this browser. This may cause issues.');
        }
    }
    window.onload = function()
    {
        var fileinput = document.getElementById('gateuploadbtn');
        var gatetextarea = document.getElementById('gateupload');
        fileinput.addEventListener('change',
            function(e)
            {
                var file = fileinput.files[0];
                var textType = /text.*/;
                if (file.type.match(textType))
                {
                    var fileReader = new FileReader();
                    fileReader.onload = function(e)
                    {
                        gatetextarea.innerText = fileReader.result;
                    }
                    fileReader.readAsText(file);
                }
                else
                {
                    alert("Please Upload a Valid Text file");
                }
            });
    }

    function readSampleGatesFile()
    {
        var gatetextarea = document.getElementById('gateupload');
        var txtFile = new XMLHttpRequest();
        txtFile.open("GET", "http://prashantvaidyanathan.github.io/resources/SampleBroad.txt", true);
        txtFile.onreadystatechange = function()
        {
            if (txtFile.readyState === 4)
            {
                if (txtFile.status === 200)
                {
                    allText = txtFile.responseText;
                    gatetextarea.innerText = allText;
                }
            }
        }
        txtFile.send(null);
    }

    </script>
    <script type="text/javascript">
        function inputFocus(i)
        {
            if(i.value == i.defaultValue)
            {
                i.value = "";
                i.style.color = "#000";
            }
        }
        function inputBlur(i)
        {
            if(i.value == "")
            {
                i.value = i.defaultValue; 
                i.style.color = "#888";
            }
        }
    </script>

</head>


<body>



    <div class="menuDiv" >
        <div style="white-space: nowrap;" align="center" >
            <h1 class="nameHeader">Clotho - MIT-BroadFoundry Demo</h1> 


            <form action="#" align="center">
                <div align="center">
                    <input type="text" class="queryText" name="clothoQuery" id="clothoQuery"  title="Object Id" style="color:#888" value="Object Id" onfocus="inputFocus(this)" onblur="inputBlur(this)" />
                </div>

            </form>         


        </div>     
    </div>

    <div class="mainBodyDiv" >
        <div class="mainConsole" >


            <div class="tabs">
                <ul class="tab-links">
                    <li class="active"><a href="#tab1">Upload Parts</a></li>
                    <li><a href="#tab2">Query Parts</a></li>
                    <li><a href="#tab3">Run Functions</a></li>

                </ul>

                <div class="tab-content">
                    <div id="tab1" class="tab active">
                        <div align="center">
                            <textarea id="gateupload" rows="15" cols="100"> </textarea>
                            <br>

                        </div>
                        <div align="center">
                            <form style="margin-bottom:10px;">
                                <input  type="radio" value="AsJSON" name="inputType" id="asJson" checked> <label style="font-size:20px;margin-right:15px">As Jason</label>
                                <input type="radio" value="Parse" name="inputType" id="parse"> <label style="font-size:20px;">Parse</label><br>
                            </form>
                            <button id="create" type="button" class="button">Save</button><br>
                        </div>
                    </div>

                    <div id="tab2" class="tab">
                       <div >
                            <input type="text" id="nameSearch" name="searchName" title="Search" style="color:#888;font-size:15px" value="Search" onfocus="inputFocus(this)" onblur="inputBlur(this)">
                            <br>
                            <br>
                        </div>
                        <div >
                            <div id="partDetailsArea" class="partDetails" style="min-width:400px" >
                                <label><b>Name : </b></label><label id="partName"></label><br>
                                <label><b>Id : </b></label><label id="partId"></label><br>
                                <label><b>Schema : </b></label><label id="partSchema"></label><br><br>
                                <label><b>Details : </b></label>
                            </div>
                            <textarea id="queryResults" class="queryResults" rows="8" cols="70"> </textarea>
                        </div>
                    </div>

                    <div id="tab3" class="tab">
                        <p>Tab #3 content goes here!</p>
                    </div>

                </div>
            </div>

        </div>

        <div class="debugConsole" >
            <div align="center">
                <p style="font-size:20px;"> <b>Debug Console</b></p> 
                <textarea id="outputWindow" style="width:50%; min-height:200px; height:100%; background-color:#9CFFA4;float:left" ></textarea>      
                <textarea id="debugWindow" style="width:49%; min-height:200px; height:100%; background-color:#E31010;color:#FFF;float:left" ></textarea>       

            </div>
        </div>
    </div>
    <script>
    $(document).ready(function() {




$('#clothoQuery').keypress(function (e) 
{
    if (e.keyCode == 13) 
    {
        var text;
        var queryVal = document.getElementById('clothoQuery').value;
        Clotho.get(queryVal).then(function(data) {
            var found=false;
            if(data !=null)
            {
                document.getElementById('debugWindow').value += ("Object Found. Name: "+data.name+" \n");  
                found = true;                                   
            }
            if(!found)
            {
                document.getElementById('debugWindow').value += ("No results obtained\n");  
            }
            document.getElementById('clothoQuery').value = "";
        }).done();
        return false;
    }   
});



$('#nameSearch').keypress(function (e) 
{
    if (e.keyCode == 13) 
    {

        document.getElementById('queryResults').value = "";
        document.getElementById('partName').innerHTML = "";
        document.getElementById('partId').innerHTML = "";
        document.getElementById('partSchema').innerHTML = "";

        var text;
        var queryVal = document.getElementById('nameSearch').value;
        Clotho.queryOne("name",queryVal).then(function(data) {
            
            var found=false;
            if(data !=null)
            {

                found = true;  
                document.getElementById('outputWindow').value += ("Data :\n" + JSON.stringify(data) +"\n");  
                document.getElementById('debugWindow').value += ("Query Object Found\n");                                 
                if(data.name !=null)
                {
                    document.getElementById('partName').innerHTML  = data.name;
                }
                if(data.id !=null)
                {
                    document.getElementById('partId').innerHTML  = data.id;
                }
                if(data.schema !=null)
                {
                    document.getElementById('partSchema').innerHTML  = data.schema;
                }
                if(data.type != null)
                {
                    document.getElementById('queryResults').value +=  ("Type : " + data.type+"\n");                    
                }
                if(data.seq != null)
                {
                    document.getElementById('queryResults').value +=  ("Sequence : " + data.seq+"\n");                    
                }
                document.getElementById('queryResults').value +=  ("\nOther Details: \n");                    
                var jsonString = JSON.stringify(data);
                var jsonMap = JSON.parse(jsonString);
                var i=0;
                for (var key in jsonMap) 
                {
                    if (jsonMap.hasOwnProperty(key)) 
                    {
                        if( (key !== "name") && (key !== "id") && (key !== "schema") && (key !== "seq") && (key !== "type"))
                        {
                            document.getElementById('queryResults').value +=  (key + " : " + jsonMap[key]+"\n"); 
                        }
                    }
                }       
                
                 
            }
            if(!found)
            {
                document.getElementById('outputWindow').value += ("No results obtained for Query : " + queryVal+"\n");  
            }
            document.getElementById('nameSearch').value = ""; 
        }).done();
        
        return false;
    }   
});

$("#create").click(function() {

    var gatelines = document.getElementById('gateupload').value;
    var gatearray = gatelines.split("\n");

    if (document.getElementById('asJson').checked)
    {
        for (var i = 0; i < gatearray.length; i++)
        {
            gateparts = gatearray[i];
            obj = JSON.parse(gateparts);
            Clotho.create(obj);
        }
    }
    else if (document.getElementById('parse').checked)
    {
        for (var i = 0; i < gatearray.length; i++)
        {
            var gateparts = gatearray[i].split(" ");
            var gtstring = "";
            gtstring += "{"
            for (var j = 0; j < gateparts.length - 1; j++)
            {
                var gatecomp = gateparts[j].split(":");
                gtstring += ("\"" + gatecomp[0] + "\":\"" + gatecomp[1] + "\",");
            }
            var gatecomp = gateparts[gateparts.length - 1].split(":");
            gtstring += ("\"" + gatecomp[0] + "\":\"" + gatecomp[1] + "\"");
            gtstring += "}"
            document.getElementById('outputWindow').value += (gtstring + "\n");
            obj = JSON.parse(gtstring);
            Clotho.create(obj);
        }
    }

var textmessage = gatearray.length + " Gates added.";
document.getElementById('outputWindow').value += (textmessage + "\n"); 
});





});
</script>    

</body>
</html>